<%-include('../layouts/adminHeader')%>

<section class="content-main">
    <div class="row">
        <div class="col-9">
            <div class="content-header">
                <h2 class="content-title">Edit Product Details</h2>
            </div>
        </div>
            <form action="/admin/editProducts?id=<%=productData._id%>"   method="post" enctype="multipart/form-data">
                <div class="col-md-6">
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="mb-2">
                                <label for="product_title" class="form-label">Product Name</label>
                                <input type="text" placeholder="Type here" class="form-control" name="productName" value="<%=productData.name%>" />
                            </div>
                            <div class="row gx-3">
                                <div class="mb-3">
                                    <label for="product_sku" class="form-label">Quantity</label>
                                    <input type="text" placeholder="Type here" class="form-control" name="quantity" value="<%=productData.quantity%>" />
                                </div>
                            </div>
                            <div class="row">
                                <div class="mb-3">
                                    <label for="product_sku" class="form-label">Category</label>
                                    
                                    <select type="text" placeholder="Type here" class="form-control" name="category" >
                                    <option selected><%= productData.categoryId.name%></option>
                                    <%categories.forEach((category)=>{%>
                                        <%if(category.isDeleted===false){%>
                                            <option value="<%=category.name%>"><%=category.name%></option>
                                        <%}%>
                                        <%})%>
                                    </select>
                                </div>
                            </div>
                            <div class="row ">
                                <div class="mb-3">
                                    <label for="product_sku" class="form-label">Price</label>
                                    <input type="number" placeholder="Type here" class="form-control" name="price" value="<%=productData.price%>"/>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- card end -->
                    <div class="card ">
                        <div class="card-body">
                            <div>
                                <label class="form-label">Description</label>
                                <input placeholder="Type here" class="form-control" rows="4" name="description" value="<%=productData.description%>" />
                            </div>
                        </div>
                    </div>
                    <!-- card end// -->
                    <div class="card ">
                        <div class="card-body row ">
                            
                            <div class="col-md-3">
                                <img class="rounded-2 " style="width: 150px;" id="preview-1" src="/multer/products/<%=productData.images.image1%>" alt="">
                                <input type="file" name="image1" onchange="previewImage(event,1)">
                            </div>
                            <div class="col-md-3">
                                <img class="rounded-2 " style="width: 150px;" id="preview-2" src="/multer/products/<%=productData.images.image2%>" alt="">
                                <input type="file" name="image2" onchange="previewImage(event,2)">
                            </div>
                            <div class="col-md-3">
                                <img class="rounded-2 " style="width: 150px;" id="preview-3" src="/multer/products/<%=productData.images.image3%>" alt="">
                                <input type="file" name="image3" onchange="previewImage(event,3)">

                            </div>
                            <div class="col-md-3">
                                <img class="rounded-2 " style="width: 150px;" id="preview-4" src="/multer/products/<%=productData.images.image4%>" alt="">
                                <input type="file" name="image4" onchange="previewImage(event,4)">

                            </div>
                        </div>
                    </div>
                </div>  
                <div>
                    <a href="/admin/products" class="btn btn-primary ">Back</a>
                    <button type="submit" class="btn btn-md rounded font-sm hover-up">Edit Products</button>
                </div>
            </form> 
    </div>
</section>

<script defer src="https://cdn.crop.guide/loader/l.js?c=DJNDTB"></script>
<script>

    
    function previewImage(event,imgIndex){
        
        let input=event.target;
        console.log("input",input);
        let image = document.querySelector(`[id^="preview-${imgIndex}"]`);
        console.log("image",image);
        
        console.log("input files",input.files);
        if(input.files && input.files[0]){
            
            let reader= new FileReader();
        
            reader.onload=function(e){
                    image.src=e.target.result;
            }
            reader.readAsDataURL(input.files[0]);
        
        }
    }

    const imageElement = document.getElementById("images");
    const imageError = document.getElementById("image-Error");

    imageElement.addEventListener("change", () => {
        inputFiles = imageElement.files;
        console.log("input Files:", inputFiles);

        if (inputFiles.length > 4) {
            imageError.textContent = "images should be upto 4";
            imageElement.value = null;

            setTimeout(() => {
                imageError.textContent = "";
            }, 5000);
        }
    });

    function addProducts() {
        // const name=document.getElementById('productName').value;
        // const quantity=document.getElementById('quantity').value;
        // const category=document.getElementById('category').value;
        // const price=document.getElementById('price').value;
        // const description=document.getElementById('description').value;

        // const image1=document.getElementById('image-1').value;

        fetch("/admin/addProducts", {
            method: "POST",
            headers: {
                "content-type": "application/json;charset=utf-8",
            },
            body: JSON.stringify({
                formData,
            }),
        })
            .then((response) => response.json())
            .then((data) => {})
            .catch((err) => {
                console.log("error:", err);
            });
    }
</script>
<%-include('../layouts/adminFooter')%>
