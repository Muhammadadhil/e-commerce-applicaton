<%- include('../layouts/header.ejs') -%>
<!-- <a href="/logout" class="btn btn-close mt-5"> Logout</a> -->
<!-- My Account Section Start -->

<!-- Button trigger modal -->


<div class="section section-padding mt-5  ">
    <div class="container">
        <div class="row gy-4 mt-5 ">
            <div class="col-md-4 ">
                <!-- My Account Menu Start -->
                <div class="my-account-menu">
                    <ul class="nav account-menu-list flex-column rounded-4">
                        <li>
                            <a class="active" data-bs-toggle="pill" href="#pills-dashboard"><i class="fa fa-tachometer"></i> Dashboard</a>
                        </li>
                        <li>
                            <a data-bs-toggle="pill" href="#pills-order"><i class="fa fa-shopping-cart"></i> Order</a>
                        </li>
                        <li>
                            <a data-bs-toggle="pill" href="#pills-wallet"><i class="fa fa-cloud-download"></i> Wallet</a>
                        </li>
                        <li>
                            <a data-bs-toggle="pill" href="#pills-address"><i class="fa fa-map-marker"></i> Address</a>
                        </li>
                        <li>
                            <a data-bs-toggle="pill" href="#pills-account"><i class="fa fa-user"></i>Password</a>
                        </li>
                        <li>
                            <a href="/logout"><i class="fa fa-sign-out"></i>Logout</a>
                        </li>
                    </ul>
                </div>
                <!-- My Account Menu End -->
            </div>
            
            <div class="col-md-8">
                <!-- Tab content start -->
                <div class="tab-content my-account-tab">
                    <div class="tab-pane fade show active" id="pills-dashboard">
                        <div class="my-account-dashboard account-wrapper">
                            <div class="account-card card">
                                <div class="card-body text-center">
                                    <h3 class="account-title text-center">Account Information</h3>
                                    <div class="profileImage-section">
                                        <img src="user/assets/images/profile-image.jpg" alt="User Profile" />
                                    </div>
                                    <div class="user-info-card">
                                        <div class="card-body">
                                            <ol class="user-info">
                                                <li class="">Firstname: <span style="font-weight: 200"><%=userData.firstName%></span></li>
                                                <br />
                                                <li class="info-label">Lastname:<%=userData.lastname%></li>
                                                <br />
                                                <li class="info-label">Email:<%=userData.email%></li>
                                                <br />
                                                <li class="info-label">Phone:<%=userData.mobile%></li>
                                                <br />
                                            </ol>
                                        </div>
                                    </div>
                                    <button type="button" class="btn btn-primary " data-bs-toggle="modal" data-bs-target="#editProfileModal">Edit Profile</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    

                    <div class="tab-pane fade" id="pills-order">
                        <div class="my-account-order account-wrapper">
                            <h4 class="account-title">Orders</h4>
                            <div class="account-table text-center table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th class="no">No</th>
                                            <th class="date">Date</th>
                                            <th class="total">Amount</th>
                                            <th class="">Payment</th>
                                            <th class="name">Inovoice</th>
                                            <th class="action">details</th>
                                        </tr>
                                    </thead>
                                    <tbody>

                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="pills-wallet">
                        <!-- <div class="my-account-download account-wrapper">
                            <div class="card">
                                <div class="card-body d-flex justify-content-between">
                                    <div>
                                        <h2 class="account-title">Wallet Balance</h2>
                                    </div>
                                    <div>
                                        <h2 class="account-title">â‚¹</h2>
                                    </div>
                                </div>
                            </div>
                            <div class="account-table text-center table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th class="name">Date</th>
                                            <th class="date">status</th>

                                            <th class="action">Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div> -->
                        </div>
                    </div>
                    <div class="tab-pane fade" id="pills-address">
                        <button class="btn btn-primary btn-hover-dark" id="showModalButton">ADD +</button><br /><br />

                        <div class="row" id="addrassArea"></div>
                    </div>

                    <!-- add address modal  -->

                    <div id="addAddressModal" class="modal">
                        <div class="modal-content">
                            <span class="close" id="closeModal">&times;</span>
                            <h4 class="account-title">Add Address</h4>
                            <!-- Your form goes here -->
                            <form id="myForm" action="/addressform" method="post" onsubmit="return validateForm()">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="single-form">
                                            <input type="text" name="name" placeholder="Name" />
                                            <p id="nameError" class="error-message"></p>
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="single-form">
                                            <input type="text" name="address" placeholder="Address" />
                                            <p id="addressError" class="error-message"></p>
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="single-form">
                                            <input type="text" name="landmark" placeholder="Landmark" />
                                            <p id="landmarkError" class="error-message"></p>
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="single-form">
                                            <input type="text" name="state" placeholder="State" />
                                            <p id="stateError" class="error-message"></p>
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="single-form">
                                            <input type="text" name="city" placeholder="City" />
                                            <p id="cityError" class="error-message"></p>
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="single-form">
                                            <input type="text" name="pincode" placeholder="Pincode" />
                                            <p id="pincodeError" class="error-message"></p>
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="single-form">
                                            <input type="text" name="phone" placeholder="Phone" />
                                            <p id="mobileError" class="error-message"></p>
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="single-form">
                                            <input type="text" name="email" placeholder="Email address" />
                                            <p id="emailError" class="error-message"></p>
                                        </div>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary btn-hover-dark mt-4 text-center">Save Change</button>
                            </form>
                        </div>
                    </div>
                    <!-- add address modal end -->

                    

                    <div class="tab-pane fade" id="pills-account">
                        <div class="my-account-details account-wrapper">
                            <div class="account-details">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="single-form">
                                            <h5 class="title">Change password</h5>
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="single-form">
                                            <input type="password" id="oldPassword" placeholder="Current Password" />
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="single-form">
                                            <input type="password" id="freshPassword" placeholder="New Password" />
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="single-form">
                                            <input type="password" id="freshConfirmation" placeholder="Confirm Password" />
                                        </div>
                                    </div>
                                    <div class="col-md-6 mx-auto text-center">
                                        <div class="single-form">
                                            <p id="change-error" class="error-message text-center"></p>
                                            <button onclick="validateAndSubmit()" class="btn btn-primary btn-hover-dark">Save Change</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Tab content End -->
    </div>
</div>

<!-- profile edit start-->

<div class="modal fade" id="editProfileModal" tabindex="-1" role="dialog" aria-labelledby="editProfileModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-header " role="document" style="max-width: 800px;">
        <div class="modal-content">
            <div class="modal-header d-flex justify-content-between align-items-center">
                <p class="modal-title " id="editProfileModalLabel">Edit Profile</p>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center">
                <form id="editProfileForm">
                    <div class="single-form">
                        <input type="text" id="editFirstName"  value="<%=userData.firstName%>" />
                        <div class="error-container">
                            <div id="firstNameError" class="error-message text-danger"></div>
                        </div>
                    </div>
                    <div class="single-form">
                        <input type="text" id="editLastName"  value="<%=userData.lastname%>" />
                        <div class="error-container">
                            <div id="lastNameError" class="error-message text-danger"></div>
                        </div>
                    </div>
                    <div class="single-form">
                        <input type="text"  value="<%=userData.email%>" disabled />
                    </div>
                    <div class="single-form">
                        <input type="tel" value="<%=userData.mobile%>" disabled/>
                    </div>
                    <input type="text" value="<%=userData._id%>" hidden>
                    <button type="button" id="editProfileSubmit" class="btn btn-primary mt-5">Save Changes</button>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- user editmodal end-->

<!-- edit profile success toast  -->
<div class="toast-container top-0 start-50 translate-middle-x p-3">
    <div class="toast fade" role="alert" aria-live="assertive" id="edit-success" aria-atomic="true">
        <div class="toast-body">
            <div class="d-flex gap-4">
                <span class="text-success "><i class="fa-solid fa-circle-info fa-lg"></i></span>
                <div class="d-flex flex-grow-1 align-items-center">
                    <span class="fw-semibold">Saved details successfully!</span>
                    <button type="button" class="btn-close btn-close-sm btn-close-black ms-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- My Account Section End -->
<script src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script> -->


<script>
    function editProfile(){
        const firstName=document.getElementById('editFirstName').value;
        const lastName=document.getElementById('editLastName').value;
        
        fetch('/editProfile',{
            method:'POST',
            headers:{
                "content-type": "application/json;charset=utf-8"
            },
            body:JSON.stringify({
                firstName,
                lastName
            })
        })
        .then(res =>res.json())
        .then(data =>{
            if(data.success){
                // const editSuccess = document.getElementById("edit-success");
                // const toast = new bootstrap.Toast(editSuccess);
                // toast.show();
                window.location.reload();

            }else{
                
            }
        })
        .catch(error =>{
            console.log(error);
        })
    }

    const editProfileButton=document.getElementById('editProfileSubmit');
    editProfileButton.addEventListener('click',()=>{
        if(validateEditProfile()){
            editProfile();
        }
    })

    function validateEditProfile(){

        console.log('validate edit profile function reached!');

        const firstName = document.getElementById("editFirstName").value;
        const lastName = document.getElementById("editLastName").value;

        const firstNameError = document.getElementById("firstNameError");
        if (!firstName.trim() || firstName==="") {
            firstNameError.textContent = "First Name is required";
            return false;
        }else if(!/^[a-zA-Z\s]+$/.test(firstName)){
            firstNameError.innerHTML = "firstname should contain only alphabetic characters";
            return false;
        } else {
            firstNameError.textContent = "";
        }

        const lastNameError = document.getElementById("lastNameError");
        if (!lastName.trim() ) {
            lastNameError.textContent = "Last Name is required";
            return false;
        }else if(!/^[a-zA-Z\s]+$/.test(lastName)){
            lastNameError.innerHTML = "lastname should contain only alphabetic characters";
            return false;
        } else {
            lastNameError.textContent = "";
        }

        return true;
    }

    function validateAndSubmit() {
        const currentPassword = document.getElementById("oldPassword").value;
        const newPassword = document.getElementById("freshPassword").value;
        const confirmPassword = document.getElementById("freshConfirmation").value;
        const errorElement = document.getElementById("change-error");

        errorElement.innerText = "";

        if (!currentPassword) {
            errorElement.innerText = "Please enter your current password.";
            return;
        }

        if (!newPassword) {
            errorElement.innerText = "Please enter a new password.";
            return;
        } else if (newPassword.length < 8) {
            errorElement.innerText = "Password cannot be less than 8";
            return;
        }

        if (!confirmPassword) {
            errorElement.innerText = "Please confirm your new password.";
            return;
        } else if (confirmPassword.length < 8) {
            errorElement.innerText = "Password cannot be less than 8";
            return;
        }

        if (newPassword !== confirmPassword) {
            errorElement.innerText = "Passwords do not match.";
            return;
        }

        callChangePassword(currentPassword, newPassword);
    }
    
</script>


<%- include('../layouts/footer.ejs') -%>
